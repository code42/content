id: Code42 Exfiltration Playbook
version: -1
name: Code42 Exfiltration Playbook
description: The Code42 Exfiltration playbook acts on Code42 Security Alerts, retrieves
  file event data, and allows security teams to remediate file exfiltration events
  by revoking access rights to cloud files or containing endpoints.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: ab4c0d6a-996e-415c-8f44-8a76d279ca15
    type: start
    task:
      id: ab4c0d6a-996e-415c-8f44-8a76d279ca15
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 520,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "1":
    id: "1"
    taskid: e588a1bf-ad9e-4755-8e55-efba11ad1aff
    type: title
    task:
      id: e588a1bf-ad9e-4755-8e55-efba11ad1aff
      version: -1
      name: Start Remediation Timer
      type: title
      iscommand: false
      brand: ""
      description: "Starts a timer to track how long it takes to resolve the alert."
    nexttasks:
      '#none#':
      - "25"
      - "34"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 520,
          "y": 195
        }
      }
    note: false
    timertriggers:
    - fieldname: remediationsla
      action: start
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: e0da957a-46bb-44b9-8ea6-408e043cae88
    type: condition
    task:
      id: e0da957a-46bb-44b9-8ea6-408e043cae88
      version: -1
      name: Review Evidence for Malicious Behavior
      type: condition
      iscommand: false
      brand: ""
      description: "Searches the related files for malicious behavior."
    nexttasks:
      '#default#':
      - "7"
      Malicious:
      - "6"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 520,
          "y": 515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "6":
    id: "6"
    taskid: b6a7b214-a52b-48cc-8c0b-bc966c11ff90
    type: title
    task:
      id: b6a7b214-a52b-48cc-8c0b-bc966c11ff90
      version: -1
      name: Malicious Behavior Determined
      type: title
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "19"
      - "22"
      - "23"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 960,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "7":
    id: "7"
    taskid: 2c7eb57c-ee9b-4059-8b73-34bdb9963ca0
    type: title
    task:
      id: 2c7eb57c-ee9b-4059-8b73-34bdb9963ca0
      version: -1
      name: Benign Behavior Determined
      type: title
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1725
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "8":
    id: "8"
    taskid: b8a80acb-a2f7-4899-88e7-16382828b9b4
    type: regular
    task:
      id: b8a80acb-a2f7-4899-88e7-16382828b9b4
      version: -1
      name: Resolve Code42 Alert
      script: Code42|||code42-alert-resolve
      type: regular
      iscommand: true
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      id:
        simple: ${incident.labels.id}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 407.5,
          "y": 2030
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "9":
    id: "9"
    taskid: 1905e906-499f-4c14-8ec1-9c02eb6ef22a
    type: title
    task:
      id: 1905e906-499f-4c14-8ec1-9c02eb6ef22a
      version: -1
      name: Stop Remediation Timer
      type: title
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "8"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 407.5,
          "y": 1885
        }
      }
    note: false
    timertriggers:
    - fieldname: remediationsla
      action: stop
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "10":
    id: "10"
    taskid: 2b0168b7-3d35-470d-8902-5517dc8e9164
    type: title
    task:
      id: 2b0168b7-3d35-470d-8902-5517dc8e9164
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 407.5,
          "y": 2380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "11":
    id: "11"
    taskid: 99490d9a-6acf-41de-8d77-1266f5d63d7f
    type: regular
    task:
      id: 99490d9a-6acf-41de-8d77-1266f5d63d7f
      version: -1
      name: Locate CrowdStrike Host
      script: CrowdstrikeFalcon|||cs-falcon-search-device
      type: regular
      iscommand: true
      brand: CrowdstrikeFalcon
      description: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      filter: {}
      hostname:
        complex:
          root: incident
          accessor: code42fileevents.oshostname
          transformers:
          - operator: uniq
      ids: {}
      platform_name: {}
      site_name: {}
      status: {}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 990,
          "y": 1010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "19":
    id: "19"
    taskid: 9bfcad2c-62a7-4c59-8140-1e5ba45199bd
    type: condition
    task:
      id: 9bfcad2c-62a7-4c59-8140-1e5ba45199bd
      version: -1
      name: Is Jira Enabled?
      type: condition
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "21"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: jira-v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 295,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "21":
    id: "21"
    taskid: 47b1400e-6d83-483c-875f-7cac4b335481
    type: regular
    task:
      id: 47b1400e-6d83-483c-875f-7cac4b335481
      version: -1
      name: Create Jira Incident Ticket
      script: jira-v2|||jira-create-issue
      type: regular
      iscommand: true
      brand: jira-v2
      description: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      assignee: {}
      description: {}
      dueDate: {}
      issueJson: {}
      issueTypeId: {}
      issueTypeName:
        simple: ${inputs.JiraType}
      labels: {}
      parentIssueId: {}
      parentIssueKey: {}
      priority: {}
      projectKey: {}
      projectName:
        simple: ${inputs.JiraProject}
      reporter: {}
      summary:
        simple: ${inputs.JiraSummary}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 397.5,
          "y": 1535
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "22":
    id: "22"
    taskid: 86aaec3f-7f38-4d4d-800b-406ca59605bd
    type: condition
    task:
      id: 86aaec3f-7f38-4d4d-800b-406ca59605bd
      version: -1
      name: Can host be contained?
      type: condition
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "11"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: brand
                      iscontext: true
                    right:
                      value:
                        simple: CrowdstrikeFalcon
                - - operator: isEqualString
                    left:
                      value:
                        simple: state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: incident.code42fileevents.oshostname
            iscontext: true
    view: |-
      {
        "position": {
          "x": 960,
          "y": 835
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "23":
    id: "23"
    taskid: ce5fa797-bd44-48ba-8ebe-62cbe6f986e5
    type: condition
    task:
      id: ce5fa797-bd44-48ba-8ebe-62cbe6f986e5
      version: -1
      name: Does Manager Email Exist?
      type: condition
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "33"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: UserManagerEmail
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1420,
          "y": 1185
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "25":
    id: "25"
    taskid: 9bccb9d7-118b-4a63-8e1d-288a4fe993a2
    type: playbook
    task:
      id: 9bccb9d7-118b-4a63-8e1d-288a4fe993a2
      version: -1
      name: Active Directory - Get User Manager Details
      playbookName: Active Directory - Get User Manager Details
      type: playbook
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      UserEmail:
        simple: ${incident.employeeemail}
      Username: {}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 305,
          "y": 340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "26":
    id: "26"
    taskid: 335b248d-7a04-4514-8890-57e3913dcdfa
    type: regular
    task:
      id: 335b248d-7a04-4514-8890-57e3913dcdfa
      version: -1
      name: Close Incident
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
      description: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      assetid: {}
      closeNotes: {}
      closeReason: {}
      code42alerttype: {}
      emailclassification: {}
      id: {}
      phishingsubtype: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 407.5,
          "y": 2205
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "27":
    id: "27"
    taskid: 10331857-eb12-46fa-8f1d-6f6239d4ac61
    type: condition
    task:
      id: 10331857-eb12-46fa-8f1d-6f6239d4ac61
      version: -1
      name: Confirm Network Contain
      type: condition
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#default#':
      - "30"
      "Yes":
      - "32"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 857.5,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "29":
    id: "29"
    taskid: 7387a45c-92d3-44ca-8f63-f66ec2b6ebaa
    type: regular
    task:
      id: 7387a45c-92d3-44ca-8f63-f66ec2b6ebaa
      version: -1
      name: Send email to manager
      script: '|||send-mail'
      type: regular
      iscommand: true
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      additionalHeader: {}
      attachCIDs: {}
      attachIDs: {}
      attachNames: {}
      bcc: {}
      body:
        simple: |-
          Data exfiltration activity has been detected by Code42 for user ${incident.labels.actor}. File exfiltration details:

          Files:
          ${incident.code42fileevents.filename}

          Paths:
          ${incident.code42fileevents.filepath}

          Exposures:
          ${incident.code42fileevents.exposure}

          If you have access to Demisto, you can view the incident details at ${inputs.DemistoInstanceURL}#/incident/${incident.id}
      cc: {}
      htmlBody: {}
      raw_message: {}
      replyTo: {}
      subject:
        simple: ${incident.name}
      templateParams: {}
      to:
        simple: ${UserManagerEmail}
      transientFile: {}
      transientFileCID: {}
      transientFileContent: {}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1645,
          "y": 1535
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "30":
    id: "30"
    taskid: ea60127b-366c-4a94-85db-339b32ca66c5
    type: regular
    task:
      id: ea60127b-366c-4a94-85db-339b32ca66c5
      version: -1
      name: Confirm Remediation Is Complete
      type: regular
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 970,
          "y": 1710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "31":
    id: "31"
    taskid: a7815436-cc18-4236-8833-318204036b2a
    type: condition
    task:
      id: a7815436-cc18-4236-8833-318204036b2a
      version: -1
      name: Determine if network contain should be bypassed based on host count
      type: condition
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#default#':
      - "27"
      "yes":
      - "30"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThan
          left:
            value:
              complex:
                root: CrowdStrike
                accessor: Device.ID
                transformers:
                - operator: count
            iscontext: true
          right:
            value:
              simple: inputs.ContainHostsMax
            iscontext: true
        - operator: isExists
          left:
            value:
              simple: CrowdStrike.Device.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 990,
          "y": 1185
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "32":
    id: "32"
    taskid: 9e908ce6-7623-4a06-865b-3725d5bab3e1
    type: regular
    task:
      id: 9e908ce6-7623-4a06-865b-3725d5bab3e1
      version: -1
      name: CrowdStrike Network Contain
      script: '|||cs-falcon-contain-host'
      type: regular
      iscommand: true
      description: ""
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      ids:
        simple: ${CrowdStrike.Device.ID}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 970,
          "y": 1535
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "33":
    id: "33"
    taskid: df73e338-6ae3-4d35-8d01-76e97fc62866
    type: condition
    task:
      id: df73e338-6ae3-4d35-8d01-76e97fc62866
      version: -1
      name: Is email integration enabled?
      type: condition
      iscommand: false
      description: ""
      brand: ""
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "29"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: brand
                      iscontext: true
                    right:
                      value:
                        simple: Mail Sender (New)
                - - operator: isEqualString
                    left:
                      value:
                        simple: state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
        - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: brand
                      iscontext: true
                    right:
                      value:
                        simple: EWS Mail Sender
                - - operator: isEqualString
                    left:
                      value:
                        simple: state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
        - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: brand
                      iscontext: true
                    right:
                      value:
                        simple: Gmail
                - - operator: isEqualString
                    left:
                      value:
                        simple: state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1532.5,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "34":
    id: "34"
    taskid: e079cdf0-deb2-41a6-8b02-9e670600835b
    type: playbook
    task:
      id: e079cdf0-deb2-41a6-8b02-9e670600835b
      version: -1
      name: Code42 File Download
      description: This playbook searches for files via Code42 security events by
        either MD5 or SHA256 hash. The data is output to the Code42.SecurityData context
        for use.
      playbookName: Code42 File Download
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      MD5:
        complex:
          root: incident
          accessor: code42eventid
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: md5checksum
      SHA256:
        complex:
          root: incident
          accessor: code42fileevents
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: sha256checksum
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 735,
          "y": 340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
system: true
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2395,
        "width": 1975,
        "x": 50,
        "y": 50
      }
    }
  }
inputs:
- key: JiraProject
  value:
    simple: Security
  required: false
  description: Jira Project for created incident ticket
  playbookInputQuery: null
- key: JiraType
  value:
    simple: Investigation
  required: false
  description: Type of Jira ticket to create
  playbookInputQuery: null
- key: JiraSummary
  value:
    simple: Code42 Security Alert for Demisto Incident ${incident.id}
  required: false
  description: Summary to use with Jira ticket creation
  playbookInputQuery: null
- key: ContainHostsMax
  value:
    simple: "2"
  required: false
  description: Maximum number of network hosts to contain.
  playbookInputQuery: null
- key: DemistoInstanceURL
  value:
    simple: https://example.com/
  required: false
  description: URL of Demisto instance for emails.
  playbookInputQuery: null
fromversion: "5.0.0"
outputs: []
